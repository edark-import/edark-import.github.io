<!-- MODO OSCURO SCRIPT -->
<script>
// Aplicar modo oscuro de inmediato al insertarse (sin parpadeo)
(function immediateDarkApply(){
    try {
        if (localStorage.getItem('modoOscuro') === 'true') {
            document.documentElement.classList.add('modo-oscuro');
            document.body.classList.add('modo-oscuro');
        }
    } catch {}
})();
// --- MODO OSCURO GLOBAL ---
function initDarkMode() {
    const switchOscuro = document.getElementById('modoOscuroSwitch');
    const labelOscuro = document.getElementById('modoOscuroLabel');
    const body = document.body;

    // Inicializar desde localStorage
    const dark = localStorage.getItem('modoOscuro') === 'true';
    if (dark) {
        body.classList.add('modo-oscuro');
        if (switchOscuro) switchOscuro.checked = true;
        if (labelOscuro) labelOscuro.innerHTML = '<i class="bi bi-sun"></i>';
    } else {
        body.classList.remove('modo-oscuro');
        if (switchOscuro) switchOscuro.checked = false;
        if (labelOscuro) labelOscuro.innerHTML = '<i class="bi bi-moon"></i>';
    }

    if (switchOscuro) {
        // Remove existing listeners to avoid duplicates
        const newSwitch = switchOscuro.cloneNode(true);
        switchOscuro.parentNode.replaceChild(newSwitch, switchOscuro);
        
        newSwitch.addEventListener('change', function () {
            if (this.checked) {
                body.classList.add('modo-oscuro');
                localStorage.setItem('modoOscuro', 'true');
                if (labelOscuro) labelOscuro.innerHTML = '<i class="bi bi-sun"></i>';
            } else {
                body.classList.remove('modo-oscuro');
                localStorage.setItem('modoOscuro', 'false');
                if (labelOscuro) labelOscuro.innerHTML = '<i class="bi bi-moon"></i>';
            }
            actualizarLogoNav();
        });
    }

    // Cambia el logo seg√∫n el modo claro/oscuro
    function actualizarLogoNav() {
        const logo = document.querySelector('.navbar-brand img');
        if (!logo) return;
        if (document.body.classList.contains('modo-oscuro')) {
            logo.src = 'img/Logo/logo_1.png';
        } else {
            logo.src = 'img/Logo/logo_2.png';
        }
    }
    actualizarLogoNav();
}

// Initialize immediately if DOM is ready, otherwise wait
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initDarkMode);
} else {
    // Try now, and retry after a short delay for navbar to load
    initDarkMode();
    setTimeout(initDarkMode, 100);
}

// Also handle nested dropdowns
document.addEventListener('DOMContentLoaded', function() {
    // Handle nested dropdown menus
    const dropdownSubmenus = document.querySelectorAll('.dropdown-submenu');
    dropdownSubmenus.forEach(function(submenu) {
        const toggle = submenu.querySelector('.dropdown-toggle');
        if (toggle) {
            toggle.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                const menu = submenu.querySelector('.dropdown-menu');
                if (menu) {
                    menu.classList.toggle('show');
                }
            });
        }
    });
});
</script>

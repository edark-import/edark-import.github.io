<!-- MODO OSCURO SCRIPT -->
<script>
// Aplicar modo oscuro de inmediato al insertarse (sin parpadeo)
(function immediateDarkApply(){
    try {
        if (localStorage.getItem('modoOscuro') === 'true') {
            document.documentElement.classList.add('modo-oscuro');
            document.body.classList.add('modo-oscuro');
        }
    } catch {}
})();
// --- MODO OSCURO GLOBAL ---
let darkModeInitialized = false;

function actualizarLogoNav() {
    const logo = document.querySelector('.navbar-brand img');
    if (!logo) return;
    if (document.body.classList.contains('modo-oscuro')) {
        logo.src = 'img/Logo/logo_1.png';
    } else {
        logo.src = 'img/Logo/logo_2.png';
    }
}

function initDarkMode() {
    if (darkModeInitialized) return;
    
    const switchOscuro = document.getElementById('modoOscuroSwitch');
    const labelOscuro = document.getElementById('modoOscuroLabel');
    
    if (!switchOscuro) return;
    
    darkModeInitialized = true;
    const body = document.body;

    // Inicializar desde localStorage
    const dark = localStorage.getItem('modoOscuro') === 'true';
    if (dark) {
        body.classList.add('modo-oscuro');
        switchOscuro.checked = true;
        if (labelOscuro) labelOscuro.innerHTML = '<i class="bi bi-sun"></i>';
    } else {
        body.classList.remove('modo-oscuro');
        switchOscuro.checked = false;
        if (labelOscuro) labelOscuro.innerHTML = '<i class="bi bi-moon"></i>';
    }

    // Agregar event listener
    switchOscuro.addEventListener('change', function () {
        if (this.checked) {
            body.classList.add('modo-oscuro');
            localStorage.setItem('modoOscuro', 'true');
            if (labelOscuro) labelOscuro.innerHTML = '<i class="bi bi-sun"></i>';
        } else {
            body.classList.remove('modo-oscuro');
            localStorage.setItem('modoOscuro', 'false');
            if (labelOscuro) labelOscuro.innerHTML = '<i class="bi bi-moon"></i>';
        }
        actualizarLogoNav();
    });

    actualizarLogoNav();
}

// Usar MutationObserver para detectar cuando el navbar se carga
const observer = new MutationObserver(function(mutations) {
    const switchOscuro = document.getElementById('modoOscuroSwitch');
    if (switchOscuro && !darkModeInitialized) {
        initDarkMode();
        observer.disconnect();
    }
});

// Observar cambios en el body
observer.observe(document.body, {
    childList: true,
    subtree: true
});

// Intentar init inmediato por si el navbar ya est√° cargado
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(initDarkMode, 50);
    });
} else {
    setTimeout(initDarkMode, 50);
}

// Also handle nested dropdowns
document.addEventListener('DOMContentLoaded', function() {
    // Handle nested dropdown menus
    const dropdownSubmenus = document.querySelectorAll('.dropdown-submenu');
    dropdownSubmenus.forEach(function(submenu) {
        const toggle = submenu.querySelector('.dropdown-toggle');
        if (toggle) {
            toggle.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                const menu = submenu.querySelector('.dropdown-menu');
                if (menu) {
                    menu.classList.toggle('show');
                }
            });
        }
    });
});
</script>
